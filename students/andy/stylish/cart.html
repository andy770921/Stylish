<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Stylish Cart</title>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/cart-style.css">
    <link rel="stylesheet" href="css/every-page-style.css">
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+TC&display=swap" rel="stylesheet">
    <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
    <!-- 加入響應式控制的Javascript套件modernizr，偵測視窗大小改變時，Search Bar正確顯示 -->
    <style>
        .tpfield {
            height: 30px;
            border-radius: 8px;
            border: solid 1px #979797;
            background-color: #ffffff;
            padding-left: 10px;
        }

        .tappay-field-focus {
            border-color: #66afe9;
            outline: 0;
            -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075), 0 0 8px rgba(102, 175, 233, .6);
            box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075), 0 0 8px rgba(102, 175, 233, .6);
        }
    </style>
    <!-- 加入TapPay style-->

</head>

<body>
    <div class="container-1">
        <img class="item-1x1" src="./image/logo.png">
        <img class="item-1x2 addCursor" src="./image/search.png" onmouseover="hover(this, './image/search-hover.png')"
            onmouseout="unhover(this, './image/search.png')">
        <div class="item-1x3">
            <div class="item-2x1 addCursor">
                <p class="barItem-1"></p>
                <p class="vertical-line-2x1">|</p>
            </div>
            <div class="item-2x2 addCursor">
                <p class="barItem-2"></p>
                <p class="vertical-line-2x2">|</p>
            </div>
            <div class="item-2x3 addCursor">
                <p class="barItem-3"></p>
            </div>
        </div>
        <form class="item-1x4">
            <input type="text" name="search" class="search-bar">
            <button>
                <img class="img-1x4 addCursor" src="./image/search.png"
                    onmouseover="hover(this, './image/search-hover.png')"
                    onmouseout="unhover(this, './image/search.png')">
            </button>
            <div class="space">&ensp;</div>
        </form>
        <div class="item-1x5">
            <a href="#1" class="cart"><img class="img-1x5 addCursor" src="./image/cart.png"
                    onmouseover="hover(this, './image/cart-hover.png')"
                    onmouseout="unhover(this, './image/cart.png')"></a>
            <a href="#2" class="member"><img class="img-1x5 addCursor" src="./image/member.png"
                    onmouseover="hover(this, './image/member-hover.png')"
                    onmouseout="unhover(this, './image/member.png')"></a>
        </div>
    </div>
    </header>
    <main>
        <nav class="container-2">
            <div class="item-2x1 addCursor display-switch">
                <p class="barItem-1"></p>
                <p class="vertical-line-2x1">|</p>
            </div>
            <div class="item-2x2 addCursor display-switch">
                <p class="barItem-2"></p>
                <p class="vertical-line-2x2">|</p>
            </div>
            <div class="item-2x3 addCursor display-switch">
                <p class="barItem-3"></p>
            </div>
        </nav>
        <div class="container-3">
            <div class="item-3x1">
                <div class="text-3x1x1">HOME > BAG</div>
                <div class="text-3x1x2">
                    <div>購物車</div>
                    <div>數量</div>
                    <div>單價</div>
                    <div>小計</div>
                    <div>&ensp;</div>
                </div>
            </div>
            <div class="item-3x2">
                <!-- <div class="cart-product-1 cart-product">
                    <div class="row-or-column-1">
                        <div class="cart-product-1x1"><img class="img-1 img-product"
                                src="https://api.appworks-school.tw/assets/201807201824/main.jpg"></div>
                        <div class="cart-product-1x2">
                            <p class="text-1 text-product">xxx</p>
                        </div>
                    </div>
                    <div class="row-or-column-2">
                        <div class="cart-product-1x3">
                            <p>數量</p>
                            <select class="qty-1 qty-product">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                            </select>
                        </div>
                        <div class="cart-product-1x4">
                            <p>單價</p>
                            <div class="price-1 price-product">NT. </div>
                        </div>
                        <div class="cart-product-1x5">
                            <p>小計</p>
                            <div class="pxq-1 pxq-product">NT. </div>
                        </div>
                    </div>
                    <div class="cart-product-1x6"><img class="trash-can-1 trash-can-product"
                            src="./image/cart-remove.png"></div>
                </div> -->
            </div>
            <form class="credit-card-form" onsubmit="getPrime(); return false;">
                <div class="item-3x3">
                    <div class="country">
                        <p>配送國家</p>
                        <select>
                            <option value="" hidden>台灣或離島</option>
                            <option value="tw">台灣</option>
                            <option value="island">離島</option>
                        </select>
                    </div>
                    <div class="pay-method">
                        <p>付款方式</p>
                        <select id="payment-method">
                            <option value="" hidden>信用卡或宅配貨到付款</option>
                            <option value="credit_card" selected="selected">信用卡</option>
                            <option value="ship_to_house">宅配貨到付款</option>
                        </select>
                    </div>
                </div>
                <div class="item-3x4">
                    <div>※ 提醒您：<br>
                        ● 選擇宅配 - 請填寫正確收件人資訊，避免包裹配送不達<br>
                        ● 選擇超商 - 請填寫正確收件人姓名(與證件相符)，避免無法領取</div>
                    <div>訂購資料</div>
                </div>

                <div class="item-3x5">
                    <div>
                        <div>收件人姓名</div>
                        <input type="text" id="receiver-name">
                    </div>
                    <div>務必填寫完整收件人姓名，避免包裹無法順利簽收</div>
                    <div>
                        <div>手機</div>
                        <input type="tel" id="phone">
                    </div>
                    <div>
                        <div>電子郵件</div>
                        <input type="text" id="email">
                    </div>
                    <div>
                        <div>地址</div>
                        <input type="text" id="address">
                    </div>
                    <div>
                        <div>配送時間</div>
                        <div class="receiving" id="receiving-time">
                            <div><input type="radio" value="moring" name="receiving-option"><span>08:00 - 12:00</span>
                            </div>
                            <div><input type="radio" value="afternoon" name="receiving-option"><span>14:00 - 18:00</span>
                            </div>
                            <div><input type="radio" value="anytime" name="receiving-option"><span>不指定</span></div>
                        </div>
                    </div>
                </div>

                <div class="item-3x5-credit">
                    <div>信用卡資料</div>
                    <div>
                        <div>信用卡號碼</div>
                        <div class="tpfield" id="card-number"></div>
                        <!-- <input type="text" name="credit-card-number"> -->
                    </div>
                    <div>
                        <div>有效期限</div>
                        <div class="tpfield" id="card-expiration-date"></div>
                        <!-- <input type="text" name="expired-time"> -->
                    </div>
                    <div>
                        <div>安全碼</div>
                        <div class="tpfield" id="card-ccv"></div>
                        <!--<input type="text" name="secure-code">-->
                    </div>
                </div>
                <div class="item-3x6">
                    <div class="product-sum">
                        <div>總金額</div>
                        <div>NT. </div>
                        <div>1999</div>
                    </div>
                    <div class="shipping-fee">
                        <div>運費</div>
                        <div>NT. </div>
                        <div>1999</div>
                    </div>
                    <div class="all-sum">
                        <div>應付金額</div>
                        <div>NT. </div>
                        <div>1999</div>
                    </div>
                </div>
                <div class="item-3x7">
                    <button type="submit" class="add-3x2">確認付款</button>
                </div>
        </div>
        </form>

        <div class="sticky">
            <div class="item-s addCursor">
                <div class="cart"><img class="img-s" src="./image/cart-mobile.png"></div>
                <span class="text-s">購物車</span>
                <span class="vertical-line-s">|</span>
            </div>

            <div class="item-s addCursor">
                <div class="member"><img class="img-s" src="./image/member-mobile.png"></div>
                <span class="text-s">會員</span>
            </div>
        </div>
    </main>

    <footer>
        <div class="container-5">
            <div class="item-5x1">
                <p class="text-5x1 addCursor">關於 Stylish</p>
                <p class="text-5x1 addCursor">服務條款</p>
                <p class="text-5x1 addCursor">隱私政策</p>
                <p class="text-5x1 addCursor">聯絡我們</p>
                <p class="text-5x1 addCursor">FAQ</p>
            </div>
            <div class="item-5x2">
                <img class="img-5x2 addCursor" src="./image/line.png">
                <img class="img-5x2 addCursor" src="./image/twitter.png">
                <img class="img-5x2 addCursor" src="./image/facebook.png">
            </div>
            <span class="item-5x3">&copy; 2018. All rights reserved.</span>
        </div>
    </footer>
    <script type="text/javascript" src="js/every-page.js"></script>
    <script type="text/javascript" src="js/cart-page.js"></script>

    <!-- 加入TapPay -->
    <script src="https://js.tappaysdk.com/tpdirect/v5.1.0"></script>

    <script>
        // --- step1: 引入相關程式碼，套件及初始變數 -----
        TPDirect.setupSDK(12348, 'app_pa1pQcKoY22IlnSXq5m5WP5jFKzoRG58VEXpT7wU62ud7mMbDOGzCYIlzzLF', 'sandbox');
        var fields = {
            number: {
                // css selector
                element: '#card-number',
                placeholder: '**** **** **** ****'
            },
            expirationDate: {
                // DOM object
                element: document.getElementById('card-expiration-date'),
                placeholder: 'MM / YY'
            },
            ccv: {
                element: '#card-ccv',
                placeholder: '後三碼'
            }
        }
        TPDirect.card.setup({
            fields: fields,
            styles: {
                // Style all elements
                'input': {
                    'color': 'gray'
                },
                // Styling ccv field
                'input.cvc': {
                    // 'font-size': '16px'
                },
                // Styling expiration-date field
                'input.expiration-date': {
                    // 'font-size': '16px'
                },
                // Styling card-number field
                'input.card-number': {
                    // 'font-size': '16px'
                },
                // style focus state
                ':focus': {
                    // 'color': 'black'
                },
                // style valid state
                '.valid': {
                    'color': 'green'
                },
                // style invalid state
                '.invalid': {
                    'color': 'red'
                },
                // Media queries
                // Note that these apply to the iframe, not the root window.
                '@media screen and (max-width: 400px)': {
                    'input': {
                        'color': 'orange'
                    }
                }
            }
        });

        // --- step2: 在打信用卡資訊時，時刻監控信用卡資訊有沒正確，正確會出現"A"， .canGetPrime 值為 true ，不正確會出現"B" -----

        // TPDirect.card.onUpdate(function (update) {
        //     const submitButton = document.querySelector('.add-3x2');
        //     if (update.canGetPrime) {
        //         // Enable submit Button to get prime.
        //         //submitButton.removeAttribute('disabled');
        //         console.log("A");
        //     } else {
        //         // Disable submit Button to get prime.
        //         //submitButton.setAttribute('disabled', true);
        //         console.log("B");
        //     }
        // });


        // --- step3:  若 .canGetPrime 值為 true ，觸發此函數時，會得到一串 Prime (result.card.prime)  -----

        function getPrime() {
            //event.preventDefault();
            // 取得 TapPay Fields 的 status
            const tappayStatus = TPDirect.card.getTappayFieldsStatus();

            // 確認是否可以 getPrime
            if (tappayStatus.canGetPrime === false) {
                alert('信用卡資訊有誤喔');
                return;
            }

            // Get prime
            TPDirect.card.getPrime((result) => {
                if (result.status !== 0) {
                    alert('get prime error ' + result.msg);
                    return;
                }
                //alert('get prime 成功，prime: ' + result.card.prime);
                

                // sendFinalOrder 函數說明: 若資料沒問題，函數會回傳移除圖片連結及庫存之後的物件。若過程中有問題，會回傳False
                const finalJsonObj = sendFinalOrder("payment-method", "receiver-name", "phone", "email", "address", "receiving-time", result.card.prime, orderJSON);
                
                function jumpToThanksWithOrderNum(parsedData) {
                    window.location.href=`thankyou.html?orderNumber=${parsedData.data.number}`;
                }
                if (finalJsonObj) {
                    //alert('收件人資料及信用卡資料正確，已送出訂單' + JSON.stringify(finalJsonObj));
                    alert('收件人資料及信用卡資料正確，已送出訂單');
                    //清除 local storage;
                    localStorage.removeItem('orderJSONinLocal');
                    postAjax(sentBuyDetailURL, finalJsonObj, jumpToThanksWithOrderNum);
                }
                
                return;
                // send prime to your server, to pay with Pay by Prime API .
                // Pay By Prime Docs: https://docs.tappaysdk.com/tutorial/zh/back.html#pay-by-prime-api
            })
        }
    </script>
</body>


</html>